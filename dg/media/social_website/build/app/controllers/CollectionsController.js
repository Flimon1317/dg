define(["require","app/controllers/DigitalGreenPageController","app/view-controllers/CollectionFiltersViewController","app/view-controllers/CollectionMostFiltersViewController","app/view-controllers/CollectionViewController","jquery"],function(e){var t=e("app/controllers/DigitalGreenPageController"),n=e("app/view-controllers/CollectionFiltersViewController"),r=e("app/view-controllers/CollectionMostFiltersViewController"),i=e("app/view-controllers/CollectionViewController"),s=e("jquery"),o=t.extend({constructor:function(e,t){this.base(e,t);var n=this._references;return n.collectionViewController.setCollectionsPerPage(12).setCollectionsPerRow(3).setVideoDrawerClasses("vidDrawer-wrapper-short vidDrawer-alt-bg").setVideosPerDrawer(4),n.collectionMostFiltersViewController.setActiveFilter("-_score"),this},_initReferences:function(){this.base();var e=this._references,t=s(".js-collections-wrapper"),o=s(".js-filters-wrapper"),u=-1;e.collectionFiltersViewController=new n(o),e.collectionViewController=new i(t,u),e.collectionMostFiltersViewController=new r(t)},_initEvents:function(){this.base();var e=this._references,t=this._boundFunctions;t.onFilterChanged=this._onFilterChanged.bind(this),e.collectionFiltersViewController.on("filterChanged",t.onFilterChanged),t.onCollectionDataProcessed=this._onCollectionDataProcessed.bind(this),e.collectionViewController.on("collectionsUpdated",t.onCollectionDataProcessed),t.onOrderChanged=this._onOrderChanged.bind(this),e.collectionMostFiltersViewController.on("orderChanged",t.onOrderChanged),t.onFiltersCleared=this._onFiltersCleared.bind(this),e.collectionFiltersViewController.on("filtersCleared",t.onFiltersCleared)},_onCollectionDataProcessed:function(e){var t=this._references.collectionFiltersViewController._references.dataFeed,n=this._references.collectionViewController._references.dataFeed._state.inputParams.filters.value,r=this._references.collectionViewController._references.dataFeed._dataModel._data.facets;n&&(t.addInputParam("filters",!0,0,!0),t.setInputParam("filters",n,!0)),t.addInputParam("facets",!0,0,!0),t.setInputParam("facets",r,!0),this._references.collectionFiltersViewController._fetchFilters(),this._references.collectionFiltersViewController.updateTotalCount(e.totalCount),this._references.collectionFiltersViewController._references.filters_cleared==0&&($(".js-collections-wrapper").attr("data-partner")!="None"&&this._references.collectionFiltersViewController._setFilterStatus("partner",$(".js-collections-wrapper").attr("data-partner"),!0),$(".js-collections-wrapper").attr("data-title")!="None"&&(this._references.collectionFiltersViewController._setFilterStatus("topic",$(".js-collections-wrapper").attr("data-title"),!0),this._references.collectionFiltersViewController._setFilterStatus("subject",$(".js-collections-wrapper").attr("data-title"),!0)),$(".js-collections-wrapper").attr("data-state")!="None"&&this._references.collectionFiltersViewController._setFilterStatus("state",$(".js-collections-wrapper").attr("data-state"),!0))},_onOrderChanged:function(e){this._references.collectionViewController.setInputParam("order_by",e)},_onFilterChanged:function(e,t,n){this._references.collectionViewController.setFilterStatus(e,t,n)},_onFiltersCleared:function(){this._references.collectionFiltersViewController._references.filters_cleared=1,this._references.collectionViewController._references.dataFeed.setInputParam("filters",0,!0),this._references.collectionFiltersViewController._references.dataFeed.setInputParam("filters",0,!0),this._references.collectionViewController._references.dataFeed.setInputParam("searchString","None"),this._references.collectionViewController._references.dataFeed._fetch(),this._references.collectionViewController.clearFilters()},_getCollections:function(){this._references.collectionViewController.getCollections()},destroy:function(){this.base()}});return o});